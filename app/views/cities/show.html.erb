<div class="grid-dash-city">
  <!-- sidebar -->
  <div class="sidebar-dash-city">
    <nav class="sidebar">
      <ul class="nav list-group">
        <li class="nav-item active">
          <%= link_to image_tag("dashboard.png", alt: "dashboard", height: 50, width: 50, border: 0), cities_path %>
        </li>
        <li class="nav-item">
          <%= link_to image_tag("todo.png", alt: "To do list", width: 50, height: 50, border: 0), cities_path %>
        </li>
        <li class="nav-item">
          <%= link_to image_tag("info.png", alt: "To do list", width: 70, height: 70, border: 0), cities_path %>
        </li>
        <li class="nav-item">
        <%= link_to image_tag("archive.png", alt: "To do list", width: 70, height: 70, border: 0), cities_path %>      </ul>
      </nav>
    </div>
    <div class="navbar-dash-city">
      <h2 class="text-center"><%= @city.name %></h2>
    </div>
    <div class="stats-line-dash-city text-center">
      <ul class="list-unstyled stats-flex-dash-city">
        <!--
        id: 1, name: "En attente de traitement"
        id: 2, name: "Commande en cours"
        id: 3, name: "Intervention programmée"
        id: 4, name: "Intervention en cours"
        id: 5, name: "Résolu"
        id: 6, name: "Annulé" -->
        <% if @city.reports.size == 0 %>
        <li class="stats-flex-item-dash-city">
          <%= image_tag("total.png",height: 70, width: 70, border: 0) %> <br>
          Aucun incident répertorié
        </li>
        <% else %>
        <li class="stats-flex-item-dash-city">
          <%= image_tag("total.png",height: 70, width: 70, border: 0) %> <br>
          Total: <%= pluralize @city.reports.size, "incident" %>
        </li>
        <% end %>
        <% if @city.reports.where(status_id: 1).size == 0 %>
        <li class="stats-flex-item-dash-city">
          <%= image_tag("enattente.png",height: 70, width: 70, border: 0) %> <br>
          Aucun incident en attente
        </li>
        <% else %>
        <li class="stats-flex-item-dash-city">
          <%= image_tag("enattente.png",height: 70, width: 70, border: 0) %> <br>
          En attente: <%= pluralize @city.reports.where(status_id: 1).size, "incident" %>
        </li>
        <% end %>
        <% if @city.reports.where(status_id: [2,4]).size == 0 %>
        <li class="stats-flex-item-dash-city">
          <%= image_tag("encours.png",height: 70, width: 70, border: 0) %> <br>
          Aucun incident en cours de résolution
        </li>
        <% else %>
        <li class="stats-flex-item-dash-city">
          <%= image_tag("encours.png",height: 70, width: 70, border: 0) %> <br>
          En cours: <%= pluralize @city.reports.where(status_id: [2,4]).size, "incident" %>
        </li>
        <% end %>
        <% if @city.reports.where(status_id: 3).size == 0 %>
        <li class="stats-flex-item-dash-city">
          <%= image_tag("schedule.png",height: 70, width: 70, border: 0) %> <br>
          Aucun incident en cours de résolution
        </li>
        <% else %>
        <li class="stats-flex-item-dash-city">
          <%= image_tag("schedule.png",height: 70, width: 70, border: 0) %> <br>
          Intervention programmée: <%= pluralize @city.reports.where(status_id: 3).size, "incident" %>
        </li>
        <% end %>
        <% if @city.reports.where(status_id: 5).size == 0 %>
        <li class="stats-flex-item-dash-city">
          <%= image_tag("resolu.png",height: 70, width: 70, border: 0) %> <br>
          Aucun incident résolu
        </li>
        <% else %>
        <li class="stats-flex-item-dash-city">
          <%= image_tag("resolu.png",height: 70, width: 70, border: 0) %> <br>
          Résolu: <%= pluralize @city.reports.where(status_id: 5).size, "incident" %>
        </li>
        <% end %>
      </ul>
    </div>
    <div class="rest-grid-dash-city">
      <div class="map-dash-city">
        <!-- GOOGLE MAP -->
        <div id="map" style="width: 100%; height: 800px;"></div>
        <% content_for(:after_js) do %>
        <%= javascript_tag do %>
        $(document).ready(function() {
        var handler = Gmaps.build('Google');
        handler.buildMap({ internal: { id: 'map' } }, function() {
        markers = handler.addMarkers(<%= raw @hash.to_json %>);
        handler.bounds.extendWith(markers);
        handler.fitMapToBounds();
        if (markers.length == 0) {
        handler.getMap().setZoom(2);
        } else if (markers.length == 1) {
        handler.getMap().setZoom(14);
        }
        });
        });
        <% end %>
        <% end %>
      </div>
      <!-- GOOGLE MAP END -->
      <div class="stats-col-dash-city">
        <div id="chart1"></div>
        <div id="chart2"></div>
        <% content_for(:after_js) do %>
        <script> Chartkick.configure({language: "fr"}); </script>
        <%= pie_chart Report.joins(:degradation).where(city: @city).group(:name).count, id: "chart1", label: "TOTO"  %>
        <%= pie_chart Report.joins(:furniture).where(city: @city).group(:name).count, id: "chart2", label: "TOTO"  %>
        <% end %>
      </div>
    </div>
  </div>
